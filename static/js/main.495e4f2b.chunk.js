(this["webpackJsonpmilano-fe"]=this["webpackJsonpmilano-fe"]||[]).push([[0],{13:function(e){e.exports=JSON.parse('{"fe":{"__ip_apiserver":"localhost","_ip_apiserver":"192.168.0.23","ip_apiserver":"15.165.143.42","port_apiserver":8080}}')},75:function(e,t,a){e.exports=a(86)},80:function(e,t,a){},85:function(e,t,a){},86:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(9),c=a.n(o),l=(a(80),a(27)),s=a.n(l),i=a(38),u=a(11),m=a(4),p=a(128),g=a(141),d=a(142),f=a(130),h=a(137),v=a(133),E=a(132),b=a(150),y=a(138),O=a(144),w=a(146),x=a(147),S=a(143),j=a(151),k=a(139),_=a(20),C=a(145),N=a(153),A=a(154),T=a(148),P=a(90),R=a(155),W=a(140),z=a(152),I=a(149),L=a(13),D=a(134),J=a(89),F=a(136),B=a(135),M=r.a.createContext(0),U=function(e){var t=e.children,a=Object(n.useState)({}),o=Object(u.a)(a,2),c=o[0],l=o[1];return r.a.createElement(M.Provider,{value:{times:c,setTimes:l}},t)},X=r.a.createContext(0),q=function(e){var t=e.children,a=Object(n.useState)([]),o=Object(u.a)(a,2),c=o[0],l=o[1];return r.a.createElement(X.Provider,{value:{images:c,setImages:l}},t)},G=r.a.createContext(0),H=function(e){var t=e.children,a=Object(n.useState)(0),o=Object(u.a)(a,2),c=o[0],l=o[1];return r.a.createElement(G.Provider,{value:{lasttime:c,setLasttime:l}},t)},$=(a(54),Object(p.a)((function(e){return{root:{minWidth:275,marginTop:10},list:{width:"100%",backgroundColor:e.palette.background.paper,position:"relative",overflow:"auto",maxHeight:300},image:{textAlign:"center"},media:{height:0,paddingTop:"56.25%"},avatar:{width:e.spacing(20),height:e.spacing(20)},avatarSm:{width:e.spacing(7),height:e.spacing(7)},heading:{fontSize:e.typography.pxToRem(15),fontWeight:e.typography.fontWeightRegular}}}))),K=function(){var e=$(),t=Object(n.useState)(!1),a=Object(u.a)(t,2),o=a[0],c=a[1],l=Object(n.useState)([]),m=Object(u.a)(l,2),p=m[0],g=m[1],d=Object(n.useState)(0),b=Object(u.a)(d,2),O=b[0],w=b[1],x=r.a.useContext(M).setTimes,S=r.a.useContext(X).setImages,j=r.a.useContext(G).lasttime,_=function(){var e=Object(i.a)(s.a.mark((function e(){var t,a,n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return x({}),S([]),c(!0),t=p[O],e.prev=4,e.next=7,fetch("http://".concat(L.fe.ip_apiserver,":").concat(L.fe.port_apiserver,"/api/v1/render"),{method:"POST",body:JSON.stringify({isAsync:!1,avatar:t.name,time_start:Date.now()}),headers:{"Content-Type":"application/json"}});case 7:if(!(a=e.sent).ok){e.next=15;break}return e.next=11,a.json();case 11:n=e.sent,console.log(n),x(n),S(n.data?n.data:[]);case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(4),console.log("error",e.t0);case 20:c(!1);case 21:case"end":return e.stop()}}),e,null,[[4,17]])})));return function(){return e.apply(this,arguments)}}();return Object(n.useEffect)((function(){(function(){var e=Object(i.a)(s.a.mark((function e(){var t,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("http://".concat(L.fe.ip_apiserver,":").concat(L.fe.port_apiserver,"/api/v1/avatar"),{method:"GET"});case 3:if(!(t=e.sent).ok){e.next=10;break}return e.next=7,t.json();case 7:(a=e.sent).ok&&a.data&&Array.isArray(a.data)&&g(a.data),console.log("avatar get",a);case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),console.log("error",e.t0);case 15:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(){return e.apply(this,arguments)}})()()}),[j]),r.a.createElement(f.a,{className:e.root},r.a.createElement(E.a,{avatar:r.a.createElement(R.a,{className:e.avatarSm}),title:"Avatars",subheader:"Select avatar"}),r.a.createElement(v.a,null,r.a.createElement(D.a,{component:"nav",className:e.list},p.map((function(e,t){return r.a.createElement(J.a,{button:!0,key:t,selected:O===t,onClick:function(e){return function(e,t){w(t)}(0,t)}},r.a.createElement(B.a,null,r.a.createElement(R.a,null)),r.a.createElement(F.a,{primary:e.name,secondary:"".concat(new Date(e.time).toLocaleString(),", ").concat(e.size," bytes")}))})))),r.a.createElement(h.a,null,r.a.createElement(y.a,{width:"100%",size:"large",color:"primary",onClick:_},"Start rendering"),o&&r.a.createElement(k.a,null)))},Q=(a(85),Object(m.a)((function(e){return{root:{height:10,borderRadius:5},colorPrimary:{backgroundColor:e.palette.grey["light"===e.palette.type?200:700]},bar:{borderRadius:5,backgroundColor:"#1a90ff"}}}))(W.a)),V="http://".concat(L.fe.ip_apiserver,":").concat(L.fe.port_apiserver,"/preset/preset0.jpg"),Y="http://".concat(L.fe.ip_apiserver,":").concat(L.fe.port_apiserver,"/preset/preset1.jpg"),Z=["from client request to AvatarEngine reception","AvatarEngine processing","from AvatarEngine sending data to FittingEngine reception","FittingEngine processing","from FittingEngine sending data to RenderEngine reception","RenderEngine processing","from RenderEngine sending data to REST API server reception","from REST API server sending data to cleitn reception"],ee=Object(p.a)((function(e){return{root:{minWidth:275,marginTop:10},image:{textAlign:"center"},media:{height:0,paddingTop:"56.25%"},avatar:{width:e.spacing(20),height:e.spacing(20)},avatarSm:{width:e.spacing(7),height:e.spacing(7)},heading:{fontSize:e.typography.pxToRem(15),fontWeight:e.typography.fontWeightRegular}}}));var te=function(){var e=ee(),t=r.a.useState("m"),a=Object(u.a)(t,2),o=a[0],c=a[1],l=r.a.useState("a"),m=Object(u.a)(l,2),p=m[0],W=m[1],D=r.a.useState(),J=Object(u.a)(D,2),F=J[0],B=J[1],U=r.a.useState(!1),q=Object(u.a)(U,2),H=q[0],$=q[1],te=r.a.useState("preset0"),ae=Object(u.a)(te,2),ne=ae[0],re=ae[1],oe=r.a.useState(),ce=Object(u.a)(oe,2),le=ce[0],se=ce[1],ie=r.a.useState([]),ue=Object(u.a)(ie,2),me=ue[0],pe=ue[1],ge=r.a.useState(0),de=Object(u.a)(ge,2),fe=de[0],he=de[1],ve=r.a.useContext(M),Ee=ve.times,be=ve.setTimes,ye=r.a.useContext(X),Oe=ye.images,we=ye.setImages,xe=r.a.useContext(G).setLasttime,Se=Object(n.useRef)(null),je=Object(n.useRef)(Date.now()),ke=function(e){xe(Date.now());try{$(!1);var t=Date.now();null==e.time_start&&(e.time_start=je.current),e.time_end=t,e.ok?(be(e),we(e.data?e.data:[])):console.log("[ok]",e.ok,e.data)}catch(a){console.log("[error]",a)}},_e=function(e){console.log("ws connecting"),Se.current=new WebSocket("ws://".concat(L.fe.ip_apiserver,":").concat(L.fe.port_apiserver)),Se.current.onmessage=function(e){try{var t=JSON.parse(e.data);ke(t)}catch(a){console.log("error",a)}},Se.current.onclose=function(e){console.log("ws on close")},Se.current.onopen=function(t){console.log("ws on open"),e&&e()},Se.current.onerror=function(e){console.log("on error",e)}};Object(n.useEffect)((function(){return function(){return Se.current&&Se.current.close()}}),[]);var Ce=function(){var e=Object(i.a)(s.a.mark((function e(){var t,a,n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return je.current=Date.now(),he(0),pe([]),we([]),$(!0),(t=new FormData).append("size",o),t.append("pose",p),"custom"===ne&&t.append("image",F),t.append("face",ne),t.append("time_start",je.current),t.append("isAsync",!1),console.log("handle","submit"),e.prev=13,e.next=16,fetch("http://".concat(L.fe.ip_apiserver,":").concat(L.fe.port_apiserver,"/api/v1/avatar"),{method:"POST",body:t});case 16:if(!(a=e.sent).ok){e.next=25;break}return e.next=20,a.json();case 20:n=e.sent,console.log("[response]",n),n.ok&&("true"===n.isAsync||!0===n.isAsync?null===Se.current?(console.log("ws null"),_e((function(){Se.current.send(JSON.stringify({id:n.id}))}))):Se.current.readyState!==WebSocket.OPEN?(console.log("ws not open"),Se.current.close(),_e((function(){Se.current.send(JSON.stringify({id:n.id}))}))):Se.current.send(JSON.stringify({id:n.id})):"false"===n.isAsync||!1===n.isAsync?ke(n):console.log("no isAsync")),e.next=27;break;case 25:console.log("res not ok"),$(!1);case 27:e.next=33;break;case 29:e.prev=29,e.t0=e.catch(13),console.log("[error]",e.t0),$(!1);case 33:case"end":return e.stop()}}),e,null,[[13,29]])})));return function(){return e.apply(this,arguments)}}();return Object(n.useEffect)((function(){var e=Object.keys(Ee).reduce((function(e,t){try{t.startsWith("time_")&&e.push([t,""!==Ee[t]?parseInt(Ee[t]):0])}catch(a){console.log("parseInt error",a)}return e}),[]),t=0,a=[];if(0!==e.length){e.sort((function(e,t){return e[1]-t[1]})),e.forEach((function(e){console.log("[timestamps]",e[0],e[1])})),e=e.filter((function(e){return 0!==e[1]})),t=e[e.length-1][1]-e[0][1],console.log("[total]",t);var n=[];e.reduce((function(e,t){return n.push(t[1]-e),t[1]}),e[0]),n.shift(),n.forEach((function(e){console.log(new Date(e).toISOString().split("T")[1],e,"ms")})),a=n.map((function(e){return[e,e/t*100]}))}he(t),pe(a)}),[Ee]),r.a.createElement("div",{className:"App"},r.a.createElement(g.a,null),r.a.createElement(d.a,{maxWidth:"lg"},r.a.createElement(f.a,{className:e.root},r.a.createElement(E.a,{avatar:r.a.createElement(R.a,{className:e.avatarSm,src:"custom"===ne?le:"preset0"===ne?V:Y}),title:"Options",subheader:"Select options"}),r.a.createElement(v.a,null,r.a.createElement(z.a,{display:"flex",flexWrap:"wrap"},r.a.createElement(z.a,{width:"50%"},r.a.createElement(S.a,{className:e.formControl,id:"size",disabled:!0},r.a.createElement(O.a,{id:"label-cloth-size"},"Cloth size"),r.a.createElement(j.a,{labelId:"label-cloth-size",id:"select-cloth-size",value:o,onChange:function(e){console.log("handle","cloth size",e.target.value),c(e.target.value)}},r.a.createElement(w.a,{value:"m"},"M"),r.a.createElement(w.a,{value:"l"},"L"),r.a.createElement(w.a,{value:"xl"},"XL")),r.a.createElement(x.a,null,"Cloth size : M/L/XL"))),r.a.createElement(z.a,{width:"50%"},r.a.createElement(S.a,{className:e.formControl,id:"pose",disabled:!0},r.a.createElement(O.a,{id:"label-pose"},"Pose"),r.a.createElement(j.a,{labelId:"label-pose",id:"select-pose",value:p,onChange:function(e){console.log("handle","pose",e.target.value),W(e.target.value)}},r.a.createElement(w.a,{value:"a"},"A pose"),r.a.createElement(w.a,{value:"t"},"T pose")),r.a.createElement(x.a,null,"Pose : T pose/A Pose"))))),r.a.createElement(v.a,null,r.a.createElement(S.a,{className:e.formControl,id:"file"},r.a.createElement(P.a,{component:"legend"},"Face"),r.a.createElement(A.a,{"aria-label":"gender",name:"gender1",value:ne,onChange:function(e){console.log("handle","use custom"),console.log(e.target.value),re(e.target.value),"custom"!==ne&&se(null)}},r.a.createElement(z.a,{display:"flex",flexWrap:"wrap"},r.a.createElement(z.a,{mr:2},r.a.createElement(T.a,{value:"preset0",control:r.a.createElement(N.a,null),label:"Preset 0"}),r.a.createElement(R.a,{variant:"preset0"===ne?"rounded":"circle",alt:"preset0",src:V,className:e.avatar})),r.a.createElement(z.a,{mr:2},r.a.createElement(T.a,{value:"preset1",control:r.a.createElement(N.a,null),label:"Preset 1"}),r.a.createElement(R.a,{variant:"preset1"===ne?"rounded":"circle",alt:"preset0",src:Y,className:e.avatar})),r.a.createElement(z.a,{mr:2},r.a.createElement(T.a,{value:"custom",control:r.a.createElement(N.a,null),label:"Custom"}),r.a.createElement(z.a,null,r.a.createElement(C.a,{type:"file",name:"image",onChange:function(e){console.log("handle","file"),console.log(e.target.files[0]),B(e.target.files[0]),se(URL.createObjectURL(e.target.files[0]))},disabled:"custom"!==ne}))))))),r.a.createElement(h.a,null,r.a.createElement(y.a,{width:"100%",size:"large",color:"primary",onClick:Ce,disabled:"custom"===ne&&!F||H},"Make avatar"),H&&r.a.createElement(k.a,null))),r.a.createElement(K,null),me&&0!==me.length&&r.a.createElement(f.a,{className:e.root},r.a.createElement(E.a,{title:"Profiling",subheader:"Total : ".concat(fe,"ms")}),r.a.createElement(v.a,null,me.map((function(e,t){return r.a.createElement(z.a,{display:"flex",alignItems:"center",key:t,my:1},r.a.createElement(z.a,{width:"100%",mr:1},r.a.createElement(_.a,{variant:"body2",color:"textSecondary"},Z.length>t&&Z[t]),r.a.createElement(Q,{variant:"determinate",value:e[1]})),r.a.createElement(z.a,{minWidth:150},r.a.createElement(_.a,{variant:"body2",color:"textSecondary"},"".concat(e[1].toFixed(2),"%, ").concat(e[0],"ms"))))})))),Oe.map((function(t,a){var n="http://".concat(L.fe.ip_apiserver,":").concat(L.fe.port_apiserver,"/").concat(t);return r.a.createElement(f.a,{className:"".concat(e.root," ").concat(e.image),key:a},r.a.createElement(I.a,{href:n,target:"_blank",rel:"noopener",color:"inherit"},r.a.createElement(b.a,{className:e.media,image:n,title:t})),r.a.createElement(v.a,null,r.a.createElement(_.a,{gutterBottom:!0,variant:"h5",component:"h2"},t)))}))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var ae=function(e){var t=e.children;return r.a.createElement(H,null,r.a.createElement(q,null,r.a.createElement(U,null,t)))},ne=function(){return r.a.createElement(ae,null,r.a.createElement(te,null))};c.a.render(r.a.createElement(ne,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[75,1,2]]]);
//# sourceMappingURL=main.495e4f2b.chunk.js.map